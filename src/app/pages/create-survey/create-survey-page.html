<main class="create-survey-page">
  <section class="create-survey-canvas" aria-label="Create survey workspace">
    <div class="create-survey-header">
      <div class="create-survey-header__left">
        <span class="create-survey-status-badge">Draft</span>
        <h1 class="create-survey-title">Create new survey</h1>
      </div>
      <button class="cancel-button" type="button" aria-label="Cancel" [routerLink]="['/']">
        <span class="cancel-button__text">Cancel</span>
        <img class="cancel-button__icon" src="/assets/close.svg" alt="" />
      </button>
    </div>
    <div class="create-survey-form-surface">
      <div class="create-survey-top-row">
        <div class="create-survey-inputs">
          <div class="create-survey-input-group">
            <label class="create-survey-field-title" for="survey-name-input">Survey name</label>
            <div class="create-survey-input-row">
              <input
                #surveyNameInput
                class="create-survey-input"
                id="survey-name-input"
                type="text"
                [value]="surveyTitle"
                aria-label="Survey title"
                (input)="limitInputLength($event); updateSurveyTitle(surveyNameInput.value)"
              />

              <button
                class="delete-button"
                type="button"
                aria-label="Clear survey input"
                (click)="clearField(surveyNameInput); updateSurveyTitle('')"
              >
                <img class="delete-button__icon" src="/assets/delete-icon.svg" alt="" />
                <img class="delete-button__icon-hover" src="/assets/delete-icon-hover.svg" alt="" />
              </button>
            </div>
          </div>

          <div class="create-survey-input-group create-survey-input-group--split">
            <label class="create-survey-field-title" for="survey-end-date-input">
              Set end date <span class="create-survey-field-title-optional">(optional)</span>
            </label>
            <div class="create-survey-input-row create-survey-input-row--split">
              <div class="create-survey-input-row__left">
                <input
                  #endDateInput
                  class="create-survey-input create-survey-input--short"
                  id="survey-end-date-input"
                  type="text"
                  aria-label="Set end date optional"
                  (input)="limitInputLength($event)"
                />

                <button
                  class="delete-button"
                  type="button"
                  aria-label="Clear end date input"
                  (click)="clearField(endDateInput)"
                >
                  <img class="delete-button__icon" src="/assets/delete-icon.svg" alt="" />
                  <img class="delete-button__icon-hover" src="/assets/delete-icon-hover.svg" alt="" />
                </button>
              </div>

              <div class="category-dropdown">
                <button
                  class="category-dropdown-button"
                  type="button"
                  aria-label="Choose category dropdown"
                  [attr.aria-expanded]="isCategoryDropdownOpen"
                  [class.is-open]="isCategoryDropdownOpen"
                  (click)="toggleCategoryDropdown()"
                >
                  <span class="category-dropdown__label">{{ selectedCategory }}</span>
                  <span class="category-dropdown__arrow" aria-hidden="true"></span>
                </button>

                @if (isCategoryDropdownOpen) {
                  <div class="category-dropdown-menu" role="menu" aria-label="Category options">
                    @for (category of categories; track category) {
                      <button
                        class="category-dropdown-menu__item"
                        type="button"
                        role="menuitem"
                        (click)="selectCategory(category)"
                      >
                        {{ category }}
                      </button>
                    }
                  </div>
                }
              </div>
            </div>
          </div>
        </div>

        <section class="description-block" aria-label="Describing text optional">
          <h2 class="description-block__title">
            Describing text <span class="description-block__title-optional">(optional)</span>
          </h2>
          <div class="description-block__input-row">
            <textarea
              #descriptionInput
              class="description-block__input"
              aria-label="Describing text optional"
              (input)="limitDescriptionLength($event)"
            ></textarea>
            <button
              class="delete-button description-block__delete"
              type="button"
              aria-label="Clear description text"
              (click)="clearField(descriptionInput)"
            >
              <img class="delete-button__icon" src="/assets/delete-icon.svg" alt="" />
              <img class="delete-button__icon-hover" src="/assets/delete-icon-hover.svg" alt="" />
            </button>
          </div>
        </section>
      </div>

      <section class="questions-section" aria-label="Question blocks">
        <div class="questions-grid">
          @for (question of questions; track question.id + '-' + question.renderVersion; let questionNumber = $index) {
            <section class="question-block" [attr.aria-label]="'Question ' + (questionNumber + 1)">
              <h2 class="question-block__title">{{ questionNumber + 1 }}. Question</h2>

              <div class="question-block__input-wrap">
                <button
                  class="delete-button question-block__delete"
                  type="button"
                  [attr.aria-label]="questionNumber === 0 ? 'Clear question 1' : 'Delete question ' + (questionNumber + 1)"
                  (click)="handleQuestionDelete(questionNumber)"
                >
                  <img class="delete-button__icon" src="/assets/delete-icon.svg" alt="" />
                  <img class="delete-button__icon-hover" src="/assets/delete-icon-hover.svg" alt="" />
                </button>

                <input
                  #questionInput
                  class="create-survey-input question-block__input"
                  type="text"
                  aria-label="Question text"
                  (input)="limitInputLength($event)"
                />
              </div>

              <div class="answers-block" aria-label="Answers">
                <div class="answers-block__header">
                  <h3 class="answers-block__title">Answers</h3>

                  <label class="answers-toggle" [attr.for]="'allow-multiple-answers-' + question.id">
                    <input
                      class="answers-toggle__input"
                      [id]="'allow-multiple-answers-' + question.id"
                      type="checkbox"
                      [checked]="question.allowMultipleAnswers"
                      (change)="onAllowMultipleAnswersChange(question.id, $event)"
                    />
                    <span class="answers-toggle__checkbox" aria-hidden="true"></span>
                    <span class="answers-toggle__text">Allow multiple answers.</span>
                  </label>
                </div>

                <div class="answers-block__list" aria-label="Answer inputs list">
                  @for (answerIndex of question.answerFieldIndexes; track answerIndex; let index = $index) {
                    <div class="answer-row">
                      <span class="answer-row__label">{{ getAnswerLabel(index) }}.</span>
                      <input
                        class="create-survey-input answer-row__input"
                        type="text"
                        [attr.aria-label]="'Answer ' + getAnswerLabel(index)"
                        (input)="limitInputLength($event)"
                      />
                      <button
                        class="delete-button"
                        type="button"
                        [attr.aria-label]="'Delete answer ' + getAnswerLabel(index)"
                        (click)="removeAnswerField(question.id, answerIndex)"
                      >
                        <img class="delete-button__icon" src="/assets/delete-icon.svg" alt="" />
                        <img class="delete-button__icon-hover" src="/assets/delete-icon-hover.svg" alt="" />
                      </button>
                    </div>
                  }
                </div>

                <div class="answers-block__footer">
                  <button
                    class="add-answer-button"
                    type="button"
                    aria-label="Add answer"
                    [disabled]="question.answerFieldIndexes.length >= maxAnswerFields"
                    (click)="addAnswerField(question.id)"
                  >
                    <span class="add-answer-button__text">Add answer</span>
                    <img class="add-answer-button__icon" src="/assets/add_circle-white.svg" alt="" />
                  </button>

                  <p class="add-answer-button__hint">You can add up to 6 answer fields.</p>
                </div>
              </div>
            </section>
          }

          @if (questions.length === 1) {
            <div class="questions-grid__single-action">
              <button
                class="add-question-button"
                type="button"
                aria-label="Add new question"
                [disabled]="questions.length >= maxQuestions"
                (click)="addQuestion()"
              >
                <span class="add-question-button__text">Add new question</span>
                <img class="add-question-button__icon" src="/assets/add_circle-white.svg" alt="" />
              </button>
            </div>
          }
        </div>

        @if (questions.length > 1) {
          <div class="questions-section__actions">
            <button
              class="add-question-button"
              type="button"
              aria-label="Add new question"
              [disabled]="questions.length >= maxQuestions"
              (click)="addQuestion()"
            >
              <span class="add-question-button__text">Add new question</span>
              <img class="add-question-button__icon" src="/assets/add_circle-white.svg" alt="" />
            </button>
          </div>
        }
      </section>
    </div>

    <div class="create-survey-footer">
      <button
        class="create-survey-submit-button"
        type="button"
        aria-label="Publish survey"
        (click)="publishSurvey()"
      >
        <span class="create-survey-submit-button__text">Publish</span>
        <img class="create-survey-submit-button__icon" src="/assets/check.svg" alt="" />
      </button>
    </div>
  </section>
</main>
